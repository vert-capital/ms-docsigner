# Story 2.8: Atualização da Documentação da API

## Status

Approved

## Story

**Como** desenvolvedor que utiliza o microserviço ms-docsigner,
**Eu quero** ter acesso a documentação completa e atualizada da API em `/docs/api`,
**Para que** eu possa integrar facilmente com todas as funcionalidades disponíveis, incluindo exemplos práticos de uso baseados no código atual.

## Acceptance Criteria

1. Criar documentação completa da API de documentos (`docs/api/documents.md`) com todos os endpoints
2. Atualizar a documentação existente de envelopes (`docs/api/clicksign-envelopes.md`) com novas funcionalidades
3. Adicionar guia de primeiros passos (`docs/api/getting-started.md`) com fluxo completo
4. Documentar o sistema de autenticação (`docs/api/authentication.md`) com exemplos de headers
5. Criar seção de exemplos práticos (`docs/api/examples/`) com casos de uso reais
6. Adicionar documentação de troubleshooting (`docs/api/error-handling.md`) com códigos de erro
7. Atualizar o épico 2.0 (`docs/epics/2.0.epic-integracao-clicksign.md`) com exemplos de integração
8. Criar referência completa da API (`docs/api/api-reference.md`) com todos os endpoints
9. Documentar configuração e variáveis de ambiente (`docs/api/configuration.md`)
10. Garantir que todos os exemplos sejam baseados no código implementado e funcionais

## Tasks / Subtasks

- [ ] Análise da documentação atual e código implementado (AC: 1, 2)

  - [ ] Revisar endpoints implementados em handlers de documentos e envelopes
  - [ ] Identificar novas funcionalidades não documentadas (base64, ativação, bulk operations)
  - [ ] Analisar DTOs e estruturas JSON API implementadas
  - [ ] Verificar exemplos funcionais no código de testes

- [ ] Criação da documentação da API de documentos (AC: 1, 8)

  - [ ] Documentar `POST /api/v1/documents` com suporte a file_path e base64
  - [ ] Documentar `GET /api/v1/documents/{id}` com resposta completa
  - [ ] Documentar `GET /api/v1/documents` com filtros e paginação
  - [ ] Documentar `PUT /api/v1/documents/{id}` para atualização
  - [ ] Documentar `DELETE /api/v1/documents/{id}` com validações
  - [ ] Incluir exemplos de requests e responses para cada endpoint
  - [ ] Documentar validações e limitações (tamanho máximo, formatos suportados)

- [ ] Atualização da documentação de envelopes existente (AC: 2, 8)

  - [ ] Adicionar documentação do endpoint `POST /{id}/activate`
  - [ ] Incluir exemplos com documentos base64
  - [ ] Documentar novos campos implementados na Story 2.7
  - [ ] Adicionar exemplos de bulk operations e atomic operations
  - [ ] Atualizar estruturas JSON API conforme implementação atual

- [ ] Criação do guia de primeiros passos (AC: 3)

  - [ ] Tutorial passo-a-passo: configuração → documento → envelope → ativação
  - [ ] Exemplo completo de integração end-to-end
  - [ ] Pré-requisitos e configuração inicial
  - [ ] Fluxo básico com códigos de exemplo funcionais

- [ ] Documentação do sistema de autenticação (AC: 4)

  - [ ] Explicar sistema JWT implementado
  - [ ] Documentar headers necessários (Authorization, Content-Type)
  - [ ] Exemplos de autenticação em diferentes linguagens
  - [ ] Troubleshooting de problemas de autenticação comuns

- [ ] Criação de seção de exemplos práticos (AC: 5, 7)

  - [ ] Casos de uso baseados nos testes de conformidade existentes
  - [ ] Exemplos de integração com diferentes frameworks
  - [ ] Scripts de exemplo em curl, JavaScript, Python
  - [ ] Cenários reais: contratos, NDAs, documentos médicos

- [ ] Documentação de troubleshooting e error handling (AC: 6)

  - [ ] Códigos de erro HTTP e suas causas
  - [ ] Mensagens de erro comuns e soluções
  - [ ] Guia de debugging com logs estruturados
  - [ ] FAQ com problemas frequentes

- [ ] Atualização do épico com exemplos de integração (AC: 7)

  - [ ] Adicionar seção de exemplos práticos no épico 2.0
  - [ ] Documentar casos de uso reais implementados
  - [ ] Incluir referências para documentação detalhada da API
  - [ ] Atualizar status do épico com funcionalidades completadas

- [ ] Criação da referência completa da API (AC: 8)

  - [ ] Consolidar todos os endpoints em um documento de referência
  - [ ] Incluir schemas de request/response
  - [ ] Documentar rate limiting e timeouts
  - [ ] Índice navegável por funcionalidade

- [ ] Documentação de configuração (AC: 9)

  - [ ] Variáveis de ambiente do Clicksign
  - [ ] Configuração para diferentes ambientes (dev, staging, prod)
  - [ ] Configurações de timeout e retry
  - [ ] Configurações de logging e monitoramento

- [ ] Validação e revisão final (AC: 10)
  - [ ] Testar todos os exemplos de código documentados
  - [ ] Verificar links internos e referências cruzadas
  - [ ] Revisar consistência de formato e estilo
  - [ ] Validar que documentação reflete implementação atual

## Dev Notes

### Arquitetura e Padrões Existentes

**Clean Architecture** [Fonte: docs/architecture/component-architecture.md]:

- Entities: Camada mais interna, contém regras de negócio (Document, Envelope)
- Use Cases: Orquestra fluxo de dados, define interfaces (DocumentUseCase, EnvelopeUseCase)
- Interface Adapters: Handlers (Gin) e Repositories (GORM)
- Frameworks & Drivers: PostgreSQL, Kafka, APIs externas (Clicksign)

**Estrutura de Documentação Atual**:

- `/docs/api/clicksign-envelopes.md` - Única documentação API existente
- Foca apenas em envelopes, falta documentação completa de documentos
- Exemplos práticos limitados, não cobre todas as funcionalidades

**Funcionalidades Implementadas para Documentar** [Baseado na análise do código]:

**API de Documentos:**

- Endpoints CRUD completos em `/src/api/handlers/handlers_document.go`
- Suporte a upload via base64 (até 7.5MB) implementado na Story 2.6
- Validações robustas com mensagens de erro estruturadas
- DTOs em `/src/infrastructure/clicksign/dto/envelope_dto.go`

**API de Envelopes:**

- Criação de envelopes com estrutura JSON API v3.0 (Story 2.7)
- Endpoint de ativação implementado
- Suporte a operações bulk e atomic operations
- Integração completa com Clicksign API

**Sistema de Autenticação:**

- Middleware JWT implementado
- Headers necessários: Authorization, Content-Type: application/vnd.api+json
- Configuração via variáveis de ambiente

### Padrões de Documentação a Seguir

**Formato de Documentação** [Fonte: docs/architecture/coding-standards-and-conventions.md]:

- Markdown estruturado com exemplos de código
- Exemplos funcionais baseados no código real
- Referências cruzadas entre documentos
- Estrutura consistente em todas as páginas

**Estrutura de Arquivos Recomendada**:

```
docs/api/
├── getting-started.md          # Tutorial inicial
├── authentication.md           # Sistema de autenticação
├── documents.md               # API de documentos completa
├── clicksign-envelopes.md     # API de envelopes (atualizar existente)
├── error-handling.md          # Troubleshooting e códigos de erro
├── configuration.md           # Configuração e variáveis de ambiente
├── api-reference.md           # Referência técnica completa
└── examples/                  # Exemplos práticos
    ├── quick-start.md
    ├── integration-examples.md
    └── use-cases.md
```

### Exemplos Baseados no Código Implementado

**Criação de Documento via Base64** [Baseado em testes de conformidade]:

```json
{
  "name": "Contrato de Prestação de Serviços",
  "file_content_base64": "JVBERi0xLjQKM...",
  "description": "Documento para assinatura digital"
}
```

**Criação de Envelope** [Baseado na implementação atual]:

```json
{
  "name": "Contrato - Cliente ABC",
  "documents_ids": [1],
  "signatory_emails": ["empresa@exemplo.com", "cliente@abc.com"],
  "message": "Favor assinar o contrato conforme acordado",
  "deadline_at": "2025-08-15T23:59:59Z",
  "remind_interval": 3
}
```

**Estrutura JSON API para Documentos** [Baseado na Story 2.7]:

```json
{
  "data": {
    "type": "documents",
    "attributes": {
      "filename": "contrato.pdf",
      "content_base64": "{{base64_content}}",
      "metadata": {
        "type": "private",
        "id": 1,
        "user": 441
      }
    }
  }
}
```

### Informações Técnicas para Documentação

**Validações Implementadas:**

- Tamanho máximo de arquivo: 7.5MB para base64
- Formatos suportados: PDF, JPEG, PNG, GIF
- Detecção automática de MIME type
- Validação de estrutura JSON conforme JSON API spec

**Headers HTTP Obrigatórios:**

- `Content-Type: application/vnd.api+json` para API Clicksign
- `Authorization: Bearer <jwt_token>` para autenticação
- `Accept: application/vnd.api+json` para responses

**Códigos de Erro Comuns:**

- 400: Dados inválidos ou formato incorreto
- 401: Token JWT ausente ou inválido
- 413: Arquivo muito grande (> 7.5MB)
- 415: Tipo de arquivo não suportado
- 500: Erro interno do servidor ou falha na integração Clicksign

### Testing

**Padrões de Teste** [Fonte: docs/architecture/testing-strategy.md]:

- Framework padrão Go (`testing`) complementado por `testify`
- Testes ao lado dos arquivos fonte (`*_test.go`)
- Mocks organizados em `/mocks/` para interfaces

**Testes de Validação da Documentação:**

- Todos os exemplos de código devem ser testados funcionalmente
- Testes de conformidade existem em `conformance_test.go` para referência
- Validar estruturas JSON API com examples da Postman Collection
- Testar fluxos end-to-end documentados nos guias

**Localização dos Testes de Referência:**

- `/src/infrastructure/clicksign/conformance_test.go` - Testes de conformidade JSON API
- `/src/api/handlers/*_test.go` - Testes de handlers para exemplos de requests
- Postman Collection em `/docs/clicksign/Clicksign_Postman_Collection.json`

### Considerações de Implementação

**Compatibilidade:** Manter referências à implementação atual, destacar funcionalidades adicionadas em cada story.

**Usabilidade:** Priorizar exemplos práticos e casos de uso reais sobre documentação puramente técnica.

**Manutenibilidade:** Estruturar documentação para facilitar atualizações futuras quando novas funcionalidades forem adicionadas.

**Referências Cruzadas:** Conectar documentação da API com épico 2.0 e arquitetura do sistema para contexto completo.

## Change Log

| Date       | Version | Description                                          | Author             |
| ---------- | ------- | ---------------------------------------------------- | ------------------ |
| 2025-07-19 | 1.0     | Story criada para atualização da documentação da API | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

### Status

### File List

### Completion Notes

### Debug Log References

## QA Results
